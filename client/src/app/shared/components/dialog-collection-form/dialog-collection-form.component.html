<div class="custom-dialog flex flex-col">
  <div mat-dialog-content class="flex flex-row justify-center">
    <form
      [formGroup]="modalForm"
      (keydown.enter)="onSubmit()"
      tabindex="0"
      enctype="multipart/form-data"
      class="flex flex-col gap-5"
    >
      <mat-form-field appearance="fill" class="w-full">
        <input
          matInput
          type="text"
          formControlName="title"
          placeholder="title"
        />
      </mat-form-field>

      <mat-form-field appearance="fill" class="w-full">
        <textarea
          matInput
          type="text"
          formControlName="description"
          placeholder="description"
        ></textarea>
      </mat-form-field>

      <mat-form-field appearance="fill" class="w-full">
        <input
          matInput
          [matAutocomplete]="auto"
          formControlName="theme"
          placeholder="theme"
        />
        <mat-autocomplete #auto>
          <mat-option
            *ngFor="let topic of filteredOptions$ | async"
            [value]="topic"
          >
            {{ topic }}
          </mat-option>
        </mat-autocomplete>
      </mat-form-field>

      <div class="w-full flex flex-col justify-between">
        <div class="flex items-center justify-center w-full">
          <label
            for="dropzone-file"
            class="flex flex-col gap-5 items-center justify-center w-full h-64 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer bg-black/10"
          >
            <div class="flex flex-col items-center justify-center pt-5 pb-6">
              <p class="mb-2 text-sm text-gray-500 dark:text-gray-400">
                <span class="font-semibold">Click to upload</span> or drag and
                drop
              </p>
              <p class="text-xs text-gray-500 dark:text-gray-400">
                SVG, PNG, JPG, WEBP, ICO, AVIF or GIF
              </p>
            </div>
            <input
              id="dropzone-file"
              type="file"
              class="hidden"
              #fileInput
              (change)="onFileSelect($event)"
            />
          </label>
        </div>
      </div>

      <div formArrayName="fields">
        <div *ngFor="let fg of fieldsGroup.controls; let i = index">
          <div [formGroupName]="i">
            <mat-form-field appearance="fill" class="w-full">
              <input
                matInput
                formControlName="type"
                placeholder='type (for example "author")'
              />
            </mat-form-field>
            <mat-form-field appearance="fill" class="w-full">
              <input
                matInput
                formControlName="value"
                placeholder='value (for example "John Doe")'
              />
            </mat-form-field>

            <div class="flex gap-5">
              <button mat-icon-button (click)="removeField(i)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </div>
        </div>

        <button mat-icon-button (click)="addField()">
          <mat-icon>add</mat-icon>
        </button>
      </div>

      <mat-dialog-actions align="end">
        <div class="w-full flex items-end justify-end gap-7">
          <button
            (click)="onClose()"
            class="w-full bg-blue-200/40 rounded max-w-[200px] px-2 py-4"
          >
            <span class="font-bold">Cancel</span>
          </button>

          <button
            (click)="onSubmit()"
            [disabled]="modalForm.invalid"
            class="w-full max-w-[200px] bg-blue-200/40 disabled:bg-black/50 px-2 py-4 rounded"
          >
            <span class="font-bold">{{ data.id ? 'Update' : 'Create' }}</span>
          </button>
        </div>
      </mat-dialog-actions>
    </form>
  </div>
</div>

<div
  class="dialog-backdrop fixed top-0 left-0 w-full h-full backdrop-blur-sm -z-10"
></div>
